{% extends "base.html" %}

{% block title %}Dashboard - SISFAC{% endblock %}

{% block content %}
<div class="flex flex-col h-full overflow-hidden" style="height: calc(100vh - 120px);">
<div class="mb-4 flex-shrink-0">
    <h2 class="text-2xl font-bold text-gray-800 mb-4">Dashboard</h2>
    
    <!-- Tarjetas de EstadÃ­sticas -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-3 mb-3">
        <div class="bg-white p-4 rounded-lg shadow border-l-4 border-blue-500">
            <div class="text-gray-600 text-xs mb-1">Total Clientes</div>
            <div class="text-2xl font-bold text-blue-600">{{ stats.total_clientes }}</div>
        </div>
        <div class="bg-white p-4 rounded-lg shadow border-l-4 border-green-500">
            <div class="text-gray-600 text-xs mb-1">Total Productos</div>
            <div class="text-2xl font-bold text-green-600">{{ stats.total_productos }}</div>
        </div>
        <div class="bg-white p-4 rounded-lg shadow border-l-4 border-indigo-500">
            <div class="text-gray-600 text-xs mb-1">Total Facturas</div>
            <div class="text-2xl font-bold text-indigo-600">{{ stats.total_facturas }}</div>
        </div>
        <div class="bg-white p-4 rounded-lg shadow border-l-4 border-red-500">
            <div class="text-gray-600 text-xs mb-1">Stock Bajo</div>
            <div class="text-2xl font-bold text-red-600">{{ stats.productos_stock_bajo }}</div>
        </div>
    </div>
    
    <!-- Tarjetas de Ventas -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-3 mb-3">
        <div class="bg-gradient-to-br from-blue-500 to-blue-600 p-4 rounded-lg shadow text-white">
            <div class="text-blue-100 text-xs mb-1">Total Facturado</div>
            <div class="text-2xl font-bold">Bs. {{ "%.2f"|format(stats.total_facturado_general) }}</div>
            <div class="text-blue-100 text-xs mt-1">Todas las facturas pagadas</div>
        </div>
        <div class="bg-gradient-to-br from-green-500 to-emerald-600 p-4 rounded-lg shadow text-white">
            <div class="text-green-100 text-xs mb-1">Facturado Este Mes</div>
            <div class="text-2xl font-bold">Bs. {{ "%.2f"|format(stats.total_facturado_mes) }}</div>
            <div class="text-green-100 text-xs mt-1">{{ stats.facturas_mes }} factura(s) este mes</div>
        </div>
        <div class="bg-gradient-to-br from-indigo-500 to-indigo-600 p-4 rounded-lg shadow text-white">
            <div class="text-indigo-100 text-xs mb-1">Facturas Pagadas</div>
            <div class="text-2xl font-bold">{{ stats.facturas_pagadas }}</div>
            <div class="text-indigo-100 text-xs mt-1">
                {% if stats.facturas_anuladas > 0 %}
                {{ stats.facturas_anuladas }} anulada(s)
                {% else %}
                Sin anuladas
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- SecciÃ³n de dos columnas -->
<div class="grid grid-cols-1 lg:grid-cols-2 gap-4 mb-3 flex-1 min-h-0">
    <!-- Ãšltimas Facturas -->
    <div class="bg-white rounded-lg shadow overflow-hidden flex flex-col">
        <div class="bg-gradient-to-r from-blue-600 to-indigo-700 px-4 py-2 flex-shrink-0">
            <h3 class="text-lg font-bold text-white">Ãšltimas Facturas</h3>
        </div>
        <div class="overflow-y-auto flex-1 min-h-0">
            {% if stats.ultimas_facturas %}
            <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50 sticky top-0">
                    <tr>
                        <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">NÃºmero</th>
                        <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">Cliente</th>
                        <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">Fecha</th>
                        <th class="px-3 py-2 text-right text-xs font-medium text-gray-500 uppercase">Total</th>
                    </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                    {% for factura in stats.ultimas_facturas %}
                    <tr class="{% if loop.index % 2 == 0 %}bg-blue-50/30{% else %}bg-white{% endif %} hover:bg-blue-100/50">
                        <td class="px-3 py-2 text-xs font-medium text-gray-900">
                            <a href="/facturas/{{ factura.id }}" class="text-blue-600 hover:text-blue-800">
                                {{ factura.numero_factura }}
                            </a>
                        </td>
                        <td class="px-3 py-2 text-xs text-gray-600 truncate max-w-[120px]">{{ factura.cliente.nombre }}</td>
                        <td class="px-3 py-2 text-xs text-gray-500">{{ factura.fecha_emision.strftime('%d/%m/%Y') }}</td>
                        <td class="px-3 py-2 text-xs font-semibold text-right text-gray-900">Bs. {{ "%.2f"|format(factura.total) }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <div class="p-6 text-center text-gray-400 text-xs">No hay facturas registradas</div>
            {% endif %}
        </div>
    </div>
    
    <!-- Productos con Stock Bajo -->
    <div class="bg-white rounded-lg shadow overflow-hidden flex flex-col">
        <div class="bg-gradient-to-r from-red-500 to-red-600 px-4 py-2 flex-shrink-0">
            <h3 class="text-lg font-bold text-white">Productos con Stock Bajo</h3>
        </div>
        <div class="overflow-y-auto flex-1 min-h-0">
            {% if stats.productos_stock_bajo_lista %}
            <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50 sticky top-0">
                    <tr>
                        <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">CÃ³digo</th>
                        <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">Nombre</th>
                        <th class="px-3 py-2 text-right text-xs font-medium text-gray-500 uppercase">Stock</th>
                        <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase">AcciÃ³n</th>
                    </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                    {% for producto in stats.productos_stock_bajo_lista %}
                    <tr class="{% if loop.index % 2 == 0 %}bg-red-50/30{% else %}bg-white{% endif %} hover:bg-red-100/50">
                        <td class="px-3 py-2 text-xs font-medium text-gray-900">{{ producto.codigo }}</td>
                        <td class="px-3 py-2 text-xs text-gray-600 truncate max-w-[150px]">{{ producto.nombre }}</td>
                        <td class="px-3 py-2 text-xs font-bold text-right {% if producto.stock == 0 %}text-red-600{% else %}text-orange-600{% endif %}">
                            {{ producto.stock }}
                        </td>
                        <td class="px-3 py-2 text-xs">
                            <a href="/inventario/{{ producto.id }}/editar" class="text-blue-600 hover:text-blue-800">Editar</a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <div class="p-6 text-center text-gray-400 text-xs">Todos los productos tienen stock suficiente</div>
            {% endif %}
        </div>
    </div>
</div>

<!-- Acciones RÃ¡pidas -->
<div class="bg-white p-4 rounded-lg shadow flex-shrink-0">
    <h3 class="text-lg font-bold mb-3 text-gray-800">Acciones RÃ¡pidas</h3>
    <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
        <a href="/clientes/nuevo" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 text-center font-semibold transition-colors text-sm">âž• Nuevo Cliente</a>
        <a href="/inventario/nuevo" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 text-center font-semibold transition-colors text-sm">âž• Nuevo Producto</a>
        <a href="/facturar" class="bg-indigo-600 text-white px-4 py-2 rounded hover:bg-indigo-700 text-center font-semibold transition-colors text-sm">ðŸ“„ Facturar</a>
    </div>
</div>
</div>
{% endblock %}

