{% extends "base.html" %}

{% block title %}Historial - {{ cliente.nombre }} - SISFAC{% endblock %}

{% block content %}
<div class="mb-6">
    <div class="flex justify-between items-center mb-4">
        <div>
            <h2 class="text-3xl font-bold text-gray-800">Historial de Facturas</h2>
            <p class="text-gray-600 mt-1">{{ cliente.nombre }}</p>
        </div>
        <a href="/clientes" class="bg-gray-400 text-white px-6 py-2 rounded hover:bg-gray-500">Volver</a>
    </div>
    
    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
                <span class="text-sm text-gray-600">Total Facturas:</span>
                <span class="text-lg font-bold text-gray-900 ml-2">{{ facturas|length }}</span>
            </div>
            <div>
                <span class="text-sm text-gray-600">Total Facturado:</span>
                <span class="text-lg font-bold text-green-600 ml-2">Bs. {{ "%.2f"|format(facturas|sum(attribute='total')) }}</span>
            </div>
        </div>
    </div>
</div>

<div class="bg-white rounded-lg shadow overflow-hidden" style="max-height: calc(100vh - 350px); overflow-y: auto;">
    <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gradient-to-r from-teal-500 to-cyan-600">
            <tr>
                <th class="px-6 py-3 text-left text-xs font-medium text-white uppercase">Número Factura</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-white uppercase">Fecha</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-white uppercase">Productos</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-white uppercase">Subtotal</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-white uppercase">IVA</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-white uppercase">Total</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-white uppercase">Acción</th>
            </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200">
            {% for factura in facturas %}
            <tr class="{% if loop.index % 2 == 0 %}bg-teal-50/30{% else %}bg-white{% endif %} hover:bg-teal-100/50">
                <td class="px-6 py-4 whitespace-nowrap">
                    <div class="text-sm font-bold text-gray-900">{{ factura.numero_factura }}</div>
                    {% if factura.talonario %}
                    <div class="text-xs text-gray-500">{{ factura.talonario.nombre }}</div>
                    {% endif %}
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{{ factura.fecha_emision.strftime('%d/%m/%Y') }}</td>
                <td class="px-6 py-4 text-sm text-gray-500">{{ factura.detalles|length }} producto(s)</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">Bs. {{ "%.2f"|format(factura.subtotal) }}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-700">Bs. {{ "%.2f"|format(factura.iva) }}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm font-semibold text-gray-900">Bs. {{ "%.2f"|format(factura.total) }}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                    <a href="/facturas/{{ factura.id }}" class="text-blue-600 hover:text-blue-900">Ver</a>
                </td>
            </tr>
            {% else %}
            <tr>
                <td colspan="7" class="px-6 py-4 text-center text-gray-500">No hay facturas registradas para este cliente</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}

